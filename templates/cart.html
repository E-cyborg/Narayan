{% extends "root.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            {% if cart.items %}
            <h1>Cart</h1>
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Total Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    
                    {% for item in cart.items %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td>₹{{ item.price }}</td>
                        <td>
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" onclick="RemoveOneItem('{{item.id}}')">-</button>
                                <input type="text" class="form-control text-center" value="{{ item.quantity }}" id="qty-{{ item.id }}" readonly>
                                <button class="btn btn-outline-secondary" onclick="addToCart('{{item.id}}')">+</button>
                            </div>
                        </td>
                        <td>₹<span id="total-{{ item.id }}">{{ item.total_price }}</span></td>
                        <td>
                            <button class="btn btn-danger" onclick="RemoveItem('{{ item.id }}')">Remove</button>
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
            <a href="/cart/checkout" class="btn btn-primary">Checkout</a>
            <h3>Total: ₹{{ cart.total }}</h3>
            {% else %}
                <div class="container text-center my-5">
                    <img src="https://cdn-icons-png.flaticon.com/512/102/102661.png" alt="Empty Cart" class="img-fluid" width="150">
                    <h2 class="mt-4">Your Cart is Empty</h2>
                    <p class="text-muted">Looks like you haven't added anything to your cart yet.</p>
                    <a href="/" class="btn btn-danger mt-3">
                        <i class="fas fa-shopping-cart"></i> Continue Shopping
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock content %}
{% block script %}
<script>
    function RemoveItem(productId) {
        fetch(`/remove_item/${productId}`, { 
            method: 'POST', 
            headers: { 
                'X-CSRFToken': getCSRFToken(),
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(`Item cart status updated! New status: ${data.new_status}`);
    
            let cartIcon = document.getElementById("cart-icon");
            if (cartIcon) {
                cartIcon.classList.add("scale-up");
                setTimeout(() => {
                    cartIcon.classList.remove("scale-up");
                }, 500);
            }
    
            // Reload the page to reflect cart updates
            window.location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    function RemoveOneItem(productId) {
        fetch(`/remove_one_item/${productId}`, { 
            method: 'POST', 
            headers: { 
                'X-CSRFToken': getCSRFToken(),
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(`Item cart status updated! New status: ${data.new_status}`);
    
            let cartIcon = document.getElementById("cart-icon");
            if (cartIcon) {
                cartIcon.classList.add("scale-up");
                setTimeout(() => {
                    cartIcon.classList.remove("scale-up");
                }, 500);
            }
    
            // Reload the page to reflect cart updates
            window.location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    function getCSRFToken() {
        return document.cookie.split('; ')
            .find(row => row.startsWith('csrftoken='))
            ?.split('=')[1];
    }
    

    function addToCart(productId) {
        fetch(`/Add_to_cart/${productId}`, { 
            method: 'POST', 
            headers: { 
                'X-CSRFToken': getCSRFToken(),
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log(`Item cart status updated! New status: ${data.new_status}`);
    
            // Apply the scale-up effect to the cart icon
            let cartIcon = document.getElementById("cart-icon");
            if (cartIcon) {
                cartIcon.classList.add("scale-up");
    
                // Remove the scale-up effect after 0.5s
                setTimeout(() => {
                    cartIcon.classList.remove("scale-up");
                }, 500);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    

</script>
{% endblock script %}



{% comment %} check the PLus minus button 
https://get.foundation/building-blocks/blocks/plus-minus-input.html
 {% endcomment %}